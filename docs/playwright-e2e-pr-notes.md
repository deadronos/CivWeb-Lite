# Playwright E2E - PR notes

Summary of UI / test changes made to stabilize failing Playwright tests

What I changed

- Mounted the Minimap inside the in-app HUD (`src/components/game-hud.tsx`) so the minimap is part of the normal DOM overlay and available to Playwright runs.
- Added an aria-label to the StatsBar turn element (`aria-label="turn"`) and updated Playwright tests to target this label. This resolves strict-mode locator ambiguities caused by multiple "Turn:" text nodes.
- Adjusted HUD/minimap CSS (lower-left placement and higher z-index) and added `pointer-events: auto` to the minimap container to ensure it is visible and clickable above overlays (`src/styles.css`).
- Tweaked the `MainMenu` backdrop so it doesn't intercept pointer events (backdrop `pointer-events: none`, panel `pointer-events: auto`) — this prevents the modal backdrop from blocking interactions with the HUD/minimap when the menu is open.

Playwright trace artifacts for failed runs

- test-results/minimap-centering-minimap--4930e-ates-camera-position-status/trace.zip

Notes and recommended follow-ups

- Tests are now able to find and click the minimap in the runs I executed; however, there were earlier flaky failures caused by timing/layering races. The safest path to full stability is to either (A) add explicit waits in the Playwright tests for HUD/menu readiness (e.g. wait for main menu to be removed or for a HUD-ready signal) or (B) emit a small, deterministic DOM event right after NEW_GAME handling and wait for that from tests.
- I recommend including the `trace.zip` artifact(s) from the failing runs in the PR attachments so reviewers can inspect the Playwright trace if needed.

Files changed (high-level)

- `src/components/game-hud.tsx` — mounted `MinimapContainer`
- `src/components/ui/overlay-ui.tsx` — mounted `GameHUD`, added `aria-label="turn"` on StatsBar turn span
- `src/components/ui/main-menu.tsx` — backdrop pointer-events change
- `src/styles.css` — `.hud-minimap` position, z-index, and pointer-events
- `playwright/tests/newgame-start.spec.ts` — updated test to use `page.getByLabel('turn')`

If you want, I can:

- Update the two tests to add explicit waits for HUD/menu readiness (fast, low-risk), then run the full Playwright suite and attach any new traces.
- Or add a small `hud-ready` DOM event to the app and update tests to wait for it (more robust, one small app change).

— Automated note generated by the e2e triage run on dev branch
